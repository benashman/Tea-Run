/**
 * Module dependencies.
 */function quality(e){var t=e.split(/ *; */),n=t[0],r=t[1]?parseFloat(t[1].split(/ *= */)[1]):1;return{value:n,quality:r}}var mime=require("connect").mime,crc32=require("buffer-crc32");exports.etag=function(e){return'"'+crc32.signed(e)+'"'};exports.locals=function(e){function t(e){for(var n in e)t[n]=e[n];return e}e.viewCallbacks=e.viewCallbacks||[];return t};exports.isAbsolute=function(e){if("/"==e[0])return!0;if(":"==e[1]&&"\\"==e[2])return!0};exports.flatten=function(e,t){var t=t||[],n=e.length;for(var r=0;r<n;++r)Array.isArray(e[r])?exports.flatten(e[r],t):t.push(e[r]);return t};exports.normalizeType=function(e){return~e.indexOf("/")?e:mime.lookup(e)};exports.normalizeTypes=function(e){var t=[];for(var n=0;n<e.length;++n)t.push(~e[n].indexOf("/")?e[n]:mime.lookup(e[n]));return t};exports.acceptsArray=function(e,t){if(!t)return e[0];var n=exports.parseAccept(t),r=exports.normalizeTypes(e),i=n.length;for(var s=0;s<i;++s)for(var o=0,u=e.length;o<u;++o)if(exports.accept(r[o].split("/"),n[s]))return e[o]};exports.accepts=function(e,t){"string"==typeof e&&(e=e.split(/ *, */));return exports.acceptsArray(e,t)};exports.accept=function(e,t){return(e[0]==t.type||"*"==t.type)&&(e[1]==t.subtype||"*"==t.subtype)};exports.parseAccept=function(e){return exports.parseQuality(e).map(function(e){var t=e.value.split("/");e.type=t[0];e.subtype=t[1];return e})};exports.parseQuality=function(e){return e.split(/ *, */).map(quality).filter(function(e){return e.quality}).sort(function(e,t){return t.quality-e.quality})};exports.escape=function(e){return String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};exports.pathRegexp=function(e,t,n,r){if(e instanceof RegExp)return e;Array.isArray(e)&&(e="("+e.join("|")+")");e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(e,n,r,i,s,o,u){t.push({name:i,optional:!!o});n=n||"";return""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||r&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")+(u?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)");return new RegExp("^"+e+"$",n?"":"i")};