var io = require("socket.io").listen(8080, {log: false}),
    connections = function () {

    var self = this;

    // variables

    self.users = {

    	ben: {
    		name: "Ben",
    		avatar: "https://si0.twimg.com/profile_images/3020635145/e79e85c09c1d993900ca438b077b0f84.jpeg",
    		sugars: 2,
            milk: true
    	},

    	saul: {
    		name: "Saul",
    		avatar: "https://si0.twimg.com/profile_images/2658881264/f21e01f199be65b193024b5e36ff4325.jpeg",
    		sugars: 1,
            milk: true
    	},

    	sam: {
    		name: "Sam",
    		avatar: "https://si0.twimg.com/profile_images/2820637288/ee3f907313988d46f6dfb252f6697426.jpeg",
    		sugars: 1,
            milk: true
    	}

    };

    // methods

    self.init = function () {

        self.setupSockets();

    };

    self.setupSockets = function () {

        io.sockets.on("connection", function (socket) {

            socket.join("home");

            // on joining, send a welcome message

            socket.emit("message", {

                message: "Connected to the socket!"

            });

            socket.on("brew", function (data) {

                console.log("Brew broadcast: ", data);

                io.sockets.in("home").emit("brew", data);

                // socket.broadcast.in("home").emit("brew", data);

            });

            socket.on("content", function (data) {

                switch (data.type) {

                    case "users":

                        console.log("Request for users received!");

                        socket.emit("content", {

                            type: "users",

                            users: self.users

                        });

                    break;

                }

            });

        });

    };

};

module.exports = connections;
